<!doctype HTML>
<html>
<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
<script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
<script src=”https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script src="https://unpkg.com/aframe-particle-system-component@1.0.9/dist/aframe-particle-system-component.min.js"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<link type="text/css" rel="stylesheet" href="tree.css">
<script>
    AFRAME.registerComponent('tree', {
        init: function () {
            // Wait for model to load.
            const el = this.el;
            this.el.addEventListener('model-loaded', function() {
                console.log("Loaded model");
                // alert("model loaded")
                // Grab the mesh / scene.
                const obj = this.el.object3D;
                // Go over the submeshes and modify materials we want.
                obj.traverse(node => {
                    console.log(node.name)
                    if (node.name.indexOf('BAUBEL') !== -1) {
                        node.visible = false
                        //node.material.color.set('red');
                    }
                });
            });

            // this.el.addEventListener('click', () => {
            //     toggleBaubles();
            // });

            this.el.addEventListener('model-error', (e) => {
                alert(e)
            });
        }
    });

    function toggleBaubles() {
        let sceneEl = document.querySelector('a-scene');
        let tree = sceneEl.querySelector('#tree-node');

        const obj = tree.object3D;

        // Go over the submeshes and modify materials we want.
        obj.traverse(node => {
            console.log(node.name)
            if (node.name.indexOf('BAUBEL') !== -1) {
                node.visible = !node.visible
                //node.material.color.set('red');
            }
        });
    }

    function placeSphere(color) {
        let sceneEl = document.querySelector('a-scene');
        let markerEl = sceneEl.querySelector('#marker-node');

        let el = document.createElement('a-sphere');
        let x_offset = (Math.random() - 0.5) * 3;
        let y_offset = (Math.random() - 0.5) * 3;
        let z_offset = (Math.random() - 0.5) * 2;

        el.setAttribute('position', { x: x_offset, y: y_offset, z: z_offset });
        el.setAttribute('radius', 0.1);
        el.setAttribute('color', color);

        markerEl.appendChild(el)
    }
</script>

<body>

<div id="info">
    <section>
    <button style='background-color: lightgreen' id="add_green" onclick="placeSphere('#3EEF2D')">Add Green</button>
    <button style='background-color: lightblue' id="add_blue" onclick="placeSphere('#3E2DEF')">Add Blue</button>
    <button style='background-color: indianred' id="add_red" onclick="placeSphere('#EF2D5E')">Add Red</button>
    <button style='background-color: white' id="showHideBauble" onclick="toggleBaubles()">Toggle</button>
    </section>
    <!--<label><input id="option_trs" name="trs" type="checkbox"/>TRS</label>
    <label><input id="option_visible" name="visible" type="checkbox" checked="checked"/>Only Visible</label>
    <label><input id="option_drawrange" name="visible" type="checkbox" checked="checked"/>Truncate drawRange</label><br/>
    <label><input id="option_binary" name="visible" type="checkbox">Binary (<code>.glb</code>)</label>
    <label><input id="option_forceindices" name="visible" type="checkbox">Force indices</label>
    <label><input id="option_forcepot" name="visible" type="checkbox">Force POT textures</label>
    <label><input id="option_maxsize" name="maxSize" type="number" value="4096" min="2" max="8192" step="1"> Max texture size</label>!-->
</div>
<!-- start the body of your page -->
<!-- add some info at the top of the page -->
<a-scene embedded arjs='sourceType: webcam; detectionMode: mono; maxDetectionRate: 30; logarithmicDepthBuffer: true;' precision="low">
<!--<a-scene embedded arjs="patternRatio: 0.50; sourceType: webcam; " renderer='logarithmicDepthBuffer: true;' precision="low">-->
    <a-assets>
        <!--<a-asset-item id="cityModel" src="https://cdn.aframe.io/test-models/models/glTF-2.0/virtualcity/VC.gltf"></a-asset-item>-->
        <!--<a-asset-item id="skull" src="./scene.gltf"></a-asset-item>-->
        <a-asset-item id="tree" src="./tree-bauble.gltf"></a-asset-item>
    </a-assets>

    <a-marker id="marker-node" type="pattern" url="/pattern-tree-50.patt">
<!--        <a-entity animation="property: rotation; to: 0 360 0; loop: true; dur: 10000" position="0 0.5 0" gltf-model="#tree" loading></a-entity>-->
        <a-entity id="tree-node" position="0 -1.5 0" gltf-model="#tree" tree></a-entity>
        <a-entity particle-system="preset: snow; particleCount: 10000;" position="0 0 15"></a-entity>
        <a-entity light="type: point; intensity: 0.75; distance: 50"
                  position="20 10 10"></a-entity>
        <a-entity light="type: point; intensity: 0.75; distance: 50"
                  position="20 10 -10"></a-entity>
        <a-entity light="type: point; intensity: 0.75; distance: 50"
                  position="20 -10 -10"></a-entity>
        <a-entity light="type: point; intensity: 0.75; distance: 50"
                  position="20 0 0"></a-entity>

    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

</body>
</html>

